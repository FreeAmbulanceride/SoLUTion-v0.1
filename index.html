<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>60/30/10 Studio — Real-Time Color Balance Metering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="simple lock">

  <!-- ============ LANDING PAGE ============ -->
  <section id="landing" class="landing">
    <div class="landing__card">
      <div class="landing__bg bg" aria-hidden="true"></div>
      <div class="landing__scrim" aria-hidden="true"></div>
      <div class="landing__content">
        <header class="landing__header">
          <div class="logo">
            <svg class="logo__icon" width="32" height="32" viewBox="0 0 32 32" fill="none" aria-hidden="true">
              <rect x="2" y="2" width="28" height="28" rx="6" fill="var(--accent, #E85A8B)"/>
              <rect x="6" y="14" width="8" height="12" rx="2" fill="var(--bg-primary, #07090F)"/>
              <rect x="16" y="10" width="5" height="16" rx="2" fill="var(--bg-primary, #07090F)" opacity="0.7"/>
              <rect x="23" y="18" width="3" height="8" rx="1.5" fill="var(--bg-primary, #07090F)" opacity="0.5"/>
            </svg>
            <span class="logo__text">60/30/10</span>
          </div>
        </header>
        
        <div class="landing__body">
          <h1 class="landing__title">On-Set Color & Composition Studio</h1>
          <p class="landing__description">
            Nail your palette and framing in real time—before the client ever says "one more take." 
            Hit the 60/30/10 balance with live metering, lock composition with golden-ratio guides, 
            and compare shots with ghost/wipe references.
          </p>
          
          <div class="landing__actions">
            <button type="button" class="btn btn--primary btn--lg" id="openStudio">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"/>
              </svg>
              Open Studio
            </button>
            <a href="https://github.com/freeambulanceride" class="btn btn--ghost" target="_blank" rel="noopener">
              SolowSolution 2025
            </a>
          </div>
        </div>
        
        <footer class="landing__footer">
          <p class="landing__note">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            Camera requires HTTPS or localhost. Mobile supported.
          </p>
        </footer>
      </div>
    </div>
  </section>

  <!-- ============ PAYWALL (if enabled) ============ -->
  <section id="paywall" class="paywall" hidden>
    <div class="paywall__card">
      <h2 class="paywall__title">60/30/10 Studio</h2>
      <p class="paywall__msg" id="pw-msg">You're on a free 3-day trial.</p>
      <p class="paywall__countdown" id="pw-countdown"></p>
      <div class="paywall__actions">
        <button type="button" class="btn btn--primary" id="btn-start-trial">Start Free Trial</button>
        <button type="button" class="btn btn--secondary" id="btn-month">Monthly</button>
        <button type="button" class="btn btn--secondary" id="btn-year">Yearly</button>
        <button type="button" class="btn btn--secondary" id="btn-life">Lifetime</button>
        <button type="button" class="btn btn--ghost" id="btn-restore">Restore Purchase</button>
      </div>
    </div>
  </section>

  <!-- ============ STUDIO APP ============ -->
  <section id="studio" class="studio" hidden>
    
    <!-- Top Navigation Bar -->
    <header class="topbar">
      <div class="topbar__left">
        <div class="logo logo--sm">
          <svg class="logo__icon" width="24" height="24" viewBox="0 0 32 32" fill="none" aria-hidden="true">
            <rect x="2" y="2" width="28" height="28" rx="6" fill="var(--accent, #E85A8B)"/>
            <rect x="6" y="14" width="8" height="12" rx="2" fill="var(--bg-primary, #07090F)"/>
            <rect x="16" y="10" width="5" height="16" rx="2" fill="var(--bg-primary, #07090F)" opacity="0.7"/>
            <rect x="23" y="18" width="3" height="8" rx="1.5" fill="var(--bg-primary, #07090F)" opacity="0.5"/>
          </svg>
          <span class="logo__text">60/30/10</span>
        </div>
      </div>
      
      <div class="topbar__center" id="modeGroup">
        <!-- Desktop: Select -->
        <select id="uiMode" class="mode-select">
          <option value="simple">Simple</option>
          <option value="pro">Pro</option>
        </select>
        <!-- Mobile: Button Toggle -->
        <div class="mode-toggle">
          <button type="button" class="mode-toggle__btn active" data-mode="simple">Simple</button>
          <button type="button" class="mode-toggle__btn" data-mode="pro">Pro</button>
        </div>
      </div>
      
      <div class="topbar__right">
        <button type="button" class="btn btn--primary" id="startBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="icon-camera">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg>
          <span class="btn__label">Start Camera</span>
        </button>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="studio__main">
      
      <!-- Video Stage -->
      <div class="stage" id="stage">
        <video id="v" autoplay muted playsinline></video>
        <canvas id="ghost" class="stage__overlay"></canvas>
        <canvas id="c" class="visually-hidden"></canvas>
        
       <!-- Stage Actions Bar (replaces lonely capture button) -->
<div class="stage-bar" id="stageBar">
  <div class="stage-bar__group">
    <button type="button" class="stage-bar__btn" id="btnCapture" title="Capture photo (Space)">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
      <span class="stage-bar__label">Snap</span>
    </button>
  </div>
  
  <div class="stage-bar__divider"></div>
  
  <div class="stage-bar__group">
    <button type="button" class="stage-bar__btn" id="btnGuideToggle" title="Composition guides (G)">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <line x1="3" y1="9" x2="21" y2="9"/>
        <line x1="3" y1="15" x2="21" y2="15"/>
        <line x1="9" y1="3" x2="9" y2="21"/>
        <line x1="15" y1="3" x2="15" y2="21"/>
      </svg>
      <span class="stage-bar__label">Guide</span>
    </button>
    
    <select id="guideSelect" class="stage-bar__select" title="Select composition guide">
      <optgroup label="Off">
        <option value="off" selected>No Guide</option>
      </optgroup>
      <optgroup label="Classic Grids">
        <option value="thirds">Rule of Thirds</option>
        <option value="phi">Phi Grid (Golden Ratio)</option>
        <option value="quadrant">Quadrant Grid</option>
        <option value="center">Center Cross</option>
      </optgroup>
      <optgroup label="Golden Ratio">
        <option value="golden-spiral-tl">Golden Spiral ↖</option>
        <option value="golden-spiral-tr">Golden Spiral ↗</option>
        <option value="golden-spiral-bl">Golden Spiral ↙</option>
        <option value="golden-spiral-br">Golden Spiral ↘</option>
      </optgroup>
      <optgroup label="Triangles &amp; Diagonals">
        <option value="golden-triangles">Golden Triangles</option>
        <option value="diagonal">Diagonal Lines</option>
        <option value="diagonal-baroque">Baroque Diagonal →↘</option>
        <option value="diagonal-sinister">Sinister Diagonal ←↙</option>
      </optgroup>
      <optgroup label="Dynamic Symmetry">
        <option value="rabatment">Rabatment</option>
        <option value="root2">√2 Rectangle</option>
        <option value="root3">√3 Rectangle</option>
        <option value="root4">√4 Rectangle</option>
        <option value="root5">√5 Rectangle (Phi)</option>
      </optgroup>
      <optgroup label="Perspective">
        <option value="perspective-1">1-Point Perspective</option>
        <option value="perspective-2">2-Point Perspective</option>
        <option value="perspective-3">3-Point Perspective</option>
      </optgroup>
      <optgroup label="Curves &amp; Shapes">
        <option value="s-curve">S-Curve</option>
        <option value="triangle">Triangle</option>
        <option value="circle">Central Circle</option>
        <option value="diamond">Diamond</option>
      </optgroup>
      <optgroup label="Portrait &amp; Framing">
        <option value="headroom">Headroom Guide</option>
        <option value="nose-room">Nose/Look Room</option>
      </optgroup>
      <optgroup label="Cinema Safe Zones">
        <option value="safe-action">Safe Action (90%)</option>
        <option value="safe-title">Safe Title (80%)</option>
      </optgroup>
      <optgroup label="Aspect Ratios">
        <option value="aspect-235">2.35:1 Cinemascope</option>
        <option value="aspect-185">1.85:1 Theatrical</option>
        <option value="aspect-11">1:1 Square</option>
        <option value="aspect-916">9:16 Stories</option>
        <option value="aspect-45">4:5 Portrait</option>
      </optgroup>
    </select>
  </div>
  
  <div class="stage-bar__divider"></div>
  
  <div class="stage-bar__group">
    <button type="button" class="stage-bar__btn" id="btnZebras" title="Exposure zebras (Z)">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3v18"/>
        <path d="M3 12h18"/>
        <path d="M5.5 5.5l13 13"/>
        <path d="M18.5 5.5l-13 13"/>
      </svg>
      <span class="stage-bar__label">Zebra</span>
    </button>
    
    <button type="button" class="stage-bar__btn" id="btnSkinTone" title="Skin tone indicator (S)">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="8" r="5"/>
        <path d="M20 21a8 8 0 0 0-16 0"/>
      </svg>
      <span class="stage-bar__label">Skin</span>
    </button>
  </div>
</div>

      <!-- Controls Sidebar -->
      <aside class="controls">
        
        <!-- Camera Selection -->
        <div class="control-card">
          <h3 class="control-card__title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            Camera
          </h3>
          <div class="control-card__body">
            <label class="field">
              <span class="field__label">Source</span>
              <select id="device" class="field__select">
                <option value="">Select camera...</option>
              </select>
            </label>
          </div>
        </div>

        <!-- Color Detection Settings -->
        <div class="control-card">
          <h3 class="control-card__title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="13.5" cy="6.5" r="2.5"/>
              <circle cx="17.5" cy="10.5" r="2.5"/>
              <circle cx="8.5" cy="7.5" r="2.5"/>
              <circle cx="6.5" cy="12.5" r="2.5"/>
              <path d="M12 22c-4.97 0-9-2.24-9-5v-.09c0-1.79 2.69-3.3 6.5-4.02L12 22l2.5-9.11c3.81.72 6.5 2.23 6.5 4.02V17c0 2.76-4.03 5-9 5z"/>
            </svg>
            Detection
          </h3>
          <div class="control-card__body">
            <label class="field field--inline">
              <input type="checkbox" id="inclNeutrals" class="field__checkbox">
              <span class="field__label">Include neutrals</span>
            </label>
            
            <label class="field">
              <span class="field__label">Clusters (K=3)</span>
              <span class="field__value" id="kval">3</span>
            </label>
            
            <label class="field">
              <span class="field__label">Min Saturation</span>
              <div class="field__row">
                <input type="range" id="satCutoff" min="0" max="40" value="12" class="field__range">
                <output id="satCutoffVal" class="field__output">0.12</output>
              </div>
            </label>
          </div>
        </div>

        <!-- Reference Image (Pro) -->
        <div class="control-card pro-only">
          <h3 class="control-card__title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            Reference
          </h3>
          <div class="control-card__body">
            <div class="field">
              <input type="file" id="refUpload" accept="image/*" class="field__file">
            </div>
            <button type="button" class="btn btn--sm btn--secondary" id="grabRef">
              Capture Current Frame
            </button>
            
            <label class="field">
              <span class="field__label">Blend Mode</span>
              <select id="overlayMode" class="field__select">
                <option value="overlay">Ghost</option>
                <option value="wipe">Split/Wipe</option>
              </select>
            </label>
            
            <label class="field">
              <span class="field__label">Opacity</span>
              <div class="field__row">
                <input type="range" id="alpha" min="0" max="100" value="35" class="field__range">
                <output class="field__output">35%</output>
              </div>
            </label>
          </div>
        </div>

        <!-- Transform Controls (Pro) -->
        <div class="control-card pro-only">
          <h3 class="control-card__title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="5 9 2 12 5 15"/>
              <polyline points="9 5 12 2 15 5"/>
              <polyline points="15 19 12 22 9 19"/>
              <polyline points="19 9 22 12 19 15"/>
              <line x1="2" y1="12" x2="22" y2="12"/>
              <line x1="12" y1="2" x2="12" y2="22"/>
            </svg>
            Transform
          </h3>
          <div class="control-card__body">
            <label class="field">
              <span class="field__label">Scale</span>
              <div class="field__row">
                <input type="range" id="scale" min="50" max="200" value="100" class="field__range">
                <output class="field__output">100%</output>
              </div>
            </label>
            
            <div class="field__grid">
              <label class="field">
                <span class="field__label">X Offset</span>
                <input type="range" id="offx" min="-200" max="200" value="0" class="field__range">
              </label>
              <label class="field">
                <span class="field__label">Y Offset</span>
                <input type="range" id="offy" min="-200" max="200" value="0" class="field__range">
              </label>
            </div>
            
            <div class="field__row field__row--switches">
              <label class="field field--inline">
                <input type="checkbox" id="flip" class="field__checkbox">
                <span class="field__label">Flip</span>
              </label>
              <label class="field field--inline">
                <input type="checkbox" id="grid" class="field__checkbox">
                <span class="field__label">Grid</span>
              </label>
            </div>
            
            <label class="field" id="wipeWrap" style="display: none;">
              <span class="field__label">Wipe Position</span>
              <input type="range" id="wipe" min="0" max="100" value="50" class="field__range">
            </label>
          </div>
        </div>

        <!-- Golden Ratio (Pro) -->
        <div class="control-card pro-only">
          <h3 class="control-card__title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 3v18"/>
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 9h18"/>
              <path d="M3 15h18"/>
              <path d="M9 3v18"/>
              <path d="M15 3v18"/>
            </svg>
            Golden Ratio
          </h3>
          <div class="control-card__body">
            <label class="field field--inline">
              <input type="checkbox" id="phiOn" class="field__checkbox">
              <span class="field__label">Show HUD</span>
            </label>
            
            <label class="field">
              <span class="field__label">Spiral</span>
              <select id="phiSpiral" class="field__select">
                <option value="off">Off</option>
                <option value="auto">Auto Detect</option>
                <option value="tl">Top Left</option>
                <option value="tr">Top Right</option>
                <option value="bl">Bottom Left</option>
                <option value="br">Bottom Right</option>
              </select>
            </label>
            
            <label class="field">
              <span class="field__label">Fit Mode</span>
              <select id="phiFit" class="field__select">
                <option value="inscribe">Fit Inside</option>
                <option value="cover">Cover Frame</option>
              </select>
            </label>
            
            <div class="field__grid">
              <label class="field">
                <span class="field__label">Quality %</span>
                <div class="field__row">
                  <input type="range" id="phiQ" min="1" max="20" value="5" class="field__range">
                  <output class="field__output">5%</output>
                </div>
              </label>
              <label class="field">
                <span class="field__label">Sat Weight</span>
                <div class="field__row">
                  <input type="range" id="satW" min="0" max="100" value="50" class="field__range">
                  <output class="field__output">50%</output>
                </div>
              </label>
            </div>
            
            <label class="field">
              <span class="field__label">Sat Curve</span>
              <div class="field__row">
                <input type="range" id="satG" min="50" max="200" value="100" class="field__range">
                <output class="field__output">100</output>
              </div>
            </label>
          </div>
        </div>

      </aside>
    </main>

    <!-- Bottom Readout Panel -->
    <footer class="readout-bar">
      <div class="readout-bar__inner">
        
        <!-- Color Bars (dynamically populated by JS) -->
        <div class="color-bars" id="bars">
          <!-- JS will inject .bar elements here -->
        </div>

        <!-- Stats -->
        <div class="readout-stats">
          <div class="stat">
            <span class="stat__label">Detected:</span>
            <span class="stat__value" id="legend">—</span>
          </div>
          <div class="stat">
            <span class="stat__label">Actual:</span>
            <span class="stat__value" id="actual">—</span>
          </div>
          <div class="stat stat--score">
            <span class="stat__label">Score:</span>
            <span class="stat__value tag" id="score">—</span>
          </div>
          <div class="stat pro-only">
            <span class="stat__label">Phi:</span>
            <span class="stat__value tag" id="phiScore">—</span>
          </div>
        </div>

        <!-- Update Mode -->
        <div class="readout-options pro-only">
          <label class="field field--inline field--sm">
            <span class="field__label">Update:</span>
            <select id="scoreUpdate" class="field__select field__select--sm">
              <option value="frame">Per frame</option>
              <option value="second">Per second</option>
            </select>
          </label>
        </div>
        
      </div>
    </footer>

    <!-- Error Display -->
    <div class="toast" id="errorToast" hidden>
      <span class="toast__message" id="err"></span>
      <button type="button" class="toast__close" onclick="this.parentElement.hidden=true" aria-label="Dismiss">&times;</button>
    </div>

  </section>
<script src="composition-guides.js"></script>
  <script src="app.js"></script>
</body>
</html>