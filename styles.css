:root{
  /* Palette inspired by attached blues/purples */
  --ui-bg:#121b38;           /* deep navy base */
  --ui-panel:#23385f;        /* indigo for panels */
  --ui-surface:#2b4a7a;      /* lighter surface */
  --ui-accent:#6db444;       /* magenta accent */
  --ui-accent-soft:#7fc8f0;  /* cyan highlight */
  --ui-text:#eef3ff;         /* off-white */
  --ui-text-muted:#cdd8ef;   /* muted */
  --ui-border:rgba(0,0,0,0.45);
  --ui-ring:color-mix(in oklab, var(--ui-accent) 45%, transparent);
  --layout-max:1040px;
  /* Legacy aliases */
  --ui-primary:var(--ui-bg);
  --ui-secondary:var(--ui-panel);
}
@supports (color: oklch(0.7 0.12 30)) {
  :root{
    --ui-bg:oklch(0.24 0.03 260);
    --ui-panel:oklch(0.38 0.06 255);
    --ui-surface:oklch(0.45 0.07 255);
    --ui-accent:oklch(61.649% 0.16228 4.39);
    --ui-accent-soft:oklch(0.70 0.12 210);
    --ui-text:oklch(0.95 0.02 250);
    --ui-text-muted:oklch(0.85 0.03 250);
  }
}

/* Base reset + font (no Times New Roman anywhere) */
* { box-sizing: border-box; }
html, body { height: 100%; }
body{
  margin:0;
  font-size:15px;
  line-height:1.45;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background:var(--ui-primary);
  color:var(--ui-text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
[hidden]{ display:none !important; }
body.lock{ overflow:hidden }

/* Buttons/links */
.btn{
  appearance:none; border:none; border-radius:10px; padding:10px 14px; font-weight:700;
  background:var(--ui-accent); color:#0A0B0D; box-shadow:0 2px 10px rgba(0,0,0,.25);
  transition:transform .08s ease, filter .12s ease;
  cursor:pointer;
}
.btn:hover{ filter:brightness(1.05) }
.btn:active{ transform:translateY(1px) }
.link{ background:none; border:none; color:var(--ui-accent); font-weight:700; cursor:pointer }

#startBtn.btn.g-start{
  font-size:1rem;
  padding:10px 18px;
  border-radius:999px;
  align-self:flex-start;
}
@media (max-width: 900px){
  #startBtn.btn.g-start{
    border-radius:12px;
    padding:10px 14px;
    font-weight:600;
    font-size:0.95rem;
  }
}
/* Desktop: structured grid instead of flex chaos */
@media (min-width: 1100px) {
  header.toolbar {
    display: grid;
    grid-template-columns: 1.1fr 1.3fr 1.2fr;
    grid-auto-rows: auto;
    column-gap: 14px;
    row-gap: 10px;
  }
  header.toolbar .group {
    flex: initial;
    width: 100%;
  }
  .g-mode    { grid-column: 1; grid-row: 1; }
  .g-start   { grid-column: 2; grid-row: 1; justify-self: center; }
  .g-camera  { grid-column: 3; grid-row: 1; }
  .g-sat     { grid-column: 1 / span 2; grid-row: 2; }
  .g-photo   { grid-column: 3; grid-row: 2; }
  .g-ref     { grid-column: 1 / span 2; grid-row: 3; }
  .g-transform { grid-column: 3; grid-row: 3; }
  .g-phi     { grid-column: 1 / -1; grid-row: 4; }
}

/* Landing */
.hero .card .bg,
.hero .card .scrim { pointer-events: none; }
.hero{
  min-height: 100dvh;
  display: grid;
  place-items: center;
  /* responsive padding; avoids overflow with side padding on mobile */
  padding: clamp(16px, 4vw, 28px);
  background: /* keep your background here */;
}

.hero .card{
  position: relative;
  width: 100%;
  max-width: 900px;
  min-height: 360px;
  margin-inline: auto;
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.18);
  box-shadow: 0 18px 40px rgba(0,0,0,0.55);
}

.card .bg{
  position:absolute; inset:0;
  background: var(--hero, url('./soLUTion1a.png')) center/cover no-repeat;
  filter:saturate(115%) contrast(1.08) brightness(.9);
  transform:scale(1.015);
}
.card .scrim{
  position:absolute; inset:0;
  background:
    radial-gradient(circle at top left, rgba(0,0,0,0.2), transparent 50%),
    linear-gradient(135deg, rgba(0,0,0,0.55), rgba(0,0,0,0.85));
}
.card .content{
  position:relative; z-index:1;
  padding:28px;
  display:grid; gap:12px;
}
.hero h1{
  margin:0 0 8px 0;
  font-size:clamp(26px, 3vw, 34px);
  line-height:1.15;
}
.hero p {
  margin:8px 0 18px 0;
  font-size:0.98rem;
  color:var(--ui-text-muted);
}
.hero .actions{ display:flex; gap:12px; flex-wrap:wrap }
@supports (padding: max(0px)) {
  .hero{
    padding-left:  max(16px, env(safe-area-inset-left));
    padding-right: max(16px, env(safe-area-inset-right));
  }
}



/* Studio */
.overlayHUD .readout { position: relative; z-index: 5; }

#studio{
  min-height:100dvh;
  padding:14px clamp(12px, 3vw, 26px) 28px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:16px;
}
header.toolbar{
  position: sticky; top:0; z-index:10;
  display:flex; flex-wrap:wrap; gap:10px; align-items:flex-start;
  padding:10px 12px; background:var(--ui-secondary);
  border-bottom:1px solid var(--ui-border); box-shadow:0 2px 18px rgba(0,0,0,.25);
  width:min(var(--layout-max), 100%);
  margin:0 auto;
  border-radius:14px;
}
.group{
  display:flex; gap:10px; align-items:center; padding:8px 10px;
  background:var(--ui-surface); border:1px solid var(--ui-border);
  border-radius:10px;
  /* backdrop-filter caused native selects to misplace dropdowns in some browsers */
  backdrop-filter:none; -webkit-backdrop-filter:none;
}
.group label{ white-space:nowrap; font-weight:500; font-size:0.95rem; }
select{
  background:transparent; color:var(--ui-text); border:1px solid var(--ui-border);
  border-radius:8px; padding:6px 8px; outline:none;
}
input[type="file"]{ color:var(--ui-text-muted) }
input[type="checkbox"]{ accent-color:var(--ui-accent) }
input[type="range"]{
  -webkit-appearance:none; appearance:none; height:22px; background:transparent; width:140px;
}
input[type="range"]::-webkit-slider-runnable-track{
  height:6px;
  background:linear-gradient(var(--ui-accent) 0 0) left/var(--pct,0%) 100% no-repeat, rgba(255,255,255,0.14);
  border-radius:999px;
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none; width:16px; height:16px; border-radius:50%;
  background:var(--ui-accent); border:2px solid #0A0B0D; margin-top:-5px; box-shadow:0 0 0 4px var(--ui-ring);
}
input[type="range"]::-moz-range-track{ height:6px; background:rgba(255,255,255,0.14); border-radius:999px }
input[type="range"]::-moz-range-progress{ height:6px; background:var(--ui-accent); border-radius:999px }
input[type="range"]::-moz-range-thumb{
  width:16px; height:16px; border-radius:50%; background:var(--ui-accent);
  border:2px solid #0A0B0D; box-shadow:0 0 0 4px var(--ui-ring);
}

#stage{
  position:relative;
  width:min(var(--layout-max), 100%);
  margin:6px auto 0;
  outline:1px solid color-mix(in oklab, var(--ui-accent) 35%, transparent);
  outline-offset:8px;
  border-radius:18px;
}
video{ width:100%; height:auto; display:block; background:#000; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.45) }
canvas.overlay{ position:absolute; inset:0; pointer-events:none; border-radius:14px }
canvas.hidden{ display:none }

.overlayHUD{
  position:static;
  display:flex;
  flex-direction:column;
  gap:10px;
  margin:10px auto 0;
  padding:10px;
  background:rgba(0,0,0,0.4);
  border:1px solid var(--ui-border);
  border-radius:12px;
  pointer-events:auto;
  width:min(var(--layout-max), 100%);
}

.overlayHUD .readout,
.overlayHUD .readout * {
  pointer-events: auto;
}
.bars{
  display:grid; gap:6px;
  background:linear-gradient(135deg, rgba(0,0,0,0.65), rgba(0,0,0,0.35));
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.08);
}
.bar{ position:relative; height:22px; background:#222; border-radius:6px; overflow:hidden }
.fill{ height:100% }
/* Smooth bar movement */
.bars .fill{
  transition: width .35s ease;   /* glide instead of snap */
  will-change: width;
}

.bar span{ position:absolute; left:8px; top:2px; font-weight:600; text-shadow:0 1px 2px rgba(0,0,0,.6) }
.bar .target{
  position:absolute; top:3px; bottom:3px; width:3px;
  background:var(--ui-accent); border-radius:2px;
  box-shadow:0 0 0 1px rgba(0,0,0,.35), 0 0 6px rgba(0,0,0,.25);
  transform:translateX(-50%); pointer-events:none;
}
.readout{ display:flex; flex-wrap:wrap; gap:14px; align-items:center; justify-content:space-between;
          background:radial-gradient(circle at top left, rgba(0,0,0,0.7), rgba(0,0,0,0.4));
          padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.08) }
.swatch{ display:inline-block; width:14px; height:14px; border-radius:3px; border:1px solid rgba(255,255,255,.35); margin-right:6px; vertical-align:-2px }
.tag{ padding:2px 10px; border-radius:999px; font-weight:600; font-size:0.85rem; color:#041 }
.tag.pass{ background:rgba(34,197,94,0.12); color:#4ade80; border:1px solid rgba(34,197,94,0.6) }
.tag.warn{ background:rgba(250,204,21,0.12); color:#fde047; border:1px solid rgba(250,204,21,0.6) }
.tag.fail{ background:rgba(248,113,113,0.12); color:#fecaca; border:1px solid rgba(248,113,113,0.7) }
#err{ color:#ff8c8c; font-weight:600 }

/* ——— Simple vs Pro ——— */
body.simple header.toolbar .pro-only { display: none !important; }

#modeGroup select {
  min-width: 120px;
}
#modeGroup .mode-toggle{
  display:none;
  width:100%;
}
#modeGroup .mode-toggle button{
  appearance:none;
  border:1px solid var(--ui-border);
  background:var(--ui-surface);
  color:var(--ui-text);
  border-radius:8px;
  padding:10px 12px;
  font-weight:700;
  cursor:pointer;
  transition:background .12s ease, color .12s ease, box-shadow .12s ease;
}
#modeGroup .mode-toggle button.active{
  background:var(--ui-accent);
  color:#0A0B0D;
  box-shadow:0 0 0 3px var(--ui-ring);
}

/* Friendlier tap targets & spacing */
header.toolbar { gap: 14px; }
.group { gap: 12px; padding: 10px 12px; }

button.btn, .btn, select, input[type="range"] {
  font-size: 0.95rem;
}

/* Smoother bars by default (JS also sets a fallback) */
.bar .fill { transition: width .35s ease; }

/* Balanced toolbar + stage widths */
header.toolbar .group{ flex:1 1 260px; }
header.toolbar .g-mode{ flex:0 0 180px; }
header.toolbar .g-start{ flex:0 0 180px; }
header.toolbar .g-camera{ flex:1 0 200px; }
header.toolbar .g-sat{ flex:1 1 360px; }
header.toolbar .g-ref{ flex:2 1 520px; }
header.toolbar .g-photo{ flex:0 0 200px; }
header.toolbar .g-transform{ flex:2 1 520px; }
header.toolbar .g-phi{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
  gap:10px;
}
header.toolbar .g-phi label{
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:6px;
}
header.toolbar .g-phi input[type="range"],
header.toolbar .g-phi select{
  width:100%;
  max-width:100%;
}

/* Pro-only visual hint */
body.pro .group.pro-only{
  background:rgba(255,255,255,0.03);
  border-style:dashed;
}

/* Desktop and large tablet: wrap neatly without stretching edge-to-edge */
@media (max-width: 1200px){
  header.toolbar{
    width:min(var(--layout-max), 100%);
    gap:10px;
  }
  header.toolbar .group{
    flex:1 1 200px;
    min-width:0;
    flex-wrap:wrap;
    row-gap:6px;
  }
}
@media (min-width: 901px){
  header.toolbar{
    align-items:flex-start;
  }
  /* ordering for more intuitive grouping */
  header.toolbar .g-mode{ order:1; }
  header.toolbar .g-start{ order:2; }
  header.toolbar .g-camera{ order:3; }
  header.toolbar .g-sat{ order:4; }
  header.toolbar .g-ref{ order:5; }
  header.toolbar .g-photo{ order:6; }
  header.toolbar .g-transform{ order:7; }
  header.toolbar .group:nth-last-of-type(1){ order:8; } /* phi group */
}

/* Mobile / narrow: stack controls and remove overflow scrolling */
@media (max-width: 900px){
  header.toolbar{
    position:static;
    top:auto;
    display:flex;
    flex-direction:column;
    align-items:stretch;
    gap:4px;
    width:100%;
    order:2; /* let the video appear first */
    margin-top:4px;
    padding:6px 8px;
  }
  #stage{ order:1; }
header.toolbar .group{
  width:100%;
  min-width:0;
  flex:1 1 auto;
  flex-direction:column;
  align-items:stretch;
  row-gap:4px;
  gap:4px;
  padding:5px 8px;
}
header.toolbar .btn{
  width:100%;
  justify-content:center;
}
  header.toolbar .group label{
    width:100%;
    display:flex;
    flex-direction:row;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  header.toolbar select,
  header.toolbar input[type="range"],
  header.toolbar input[type="file"]{
  width:100%;
  max-width:100%;
}
header.toolbar label input[type="checkbox"]{
  width:auto;
  margin-right:8px;
}
header.toolbar input[type="range"]{
  margin:0;
}
header.toolbar .group > *{ margin:0; }
/* Use button toggle for Mode on mobile */
#modeGroup select{ display:none; }
#modeGroup .mode-toggle{ display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:8px; }
  /* HUD already static; tighten spacing on mobile */
  .bars{ gap:8px; }
  #stage{
    display:flex;
    flex-direction:column;
  }
  #stage{
    width:100%;
    margin:4px 0 0;
    border-radius:0;
    outline:none;
  }
  video, canvas.overlay{ border-radius:0 }
  .overlayHUD{ left:10px; right:10px; bottom:10px }
}

@media (max-width: 900px) and (orientation: landscape){
  #stage{ min-height: calc(100dvh - 8px) }
}
